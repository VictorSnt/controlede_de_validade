{% extends 'base.html' %}

{% block content %}
    <form class="search-form" method="GET" action="{% url 'expiration_list' %}">
        <div class="input-group">
            <input class="form-control search-input" type="text" name="search" placeholder="Digite para pesquisar" />
            <div class="input-group-append">
                <button class="btn btn-outline-secondary search-button" type="submit">
                    <i class="fas fa-search"></i> Pesquisar
                </button>
            </div>
        </div>
    </form>

    <div class="validades-cards">
        {% for validade in validades_paginadas %}
            <div class="card mb-4 validade-card">
                <img src="{{ validade.imagem.url }}" alt="Imagem do Produto" class="card-img-top" style="max-height: 200px; object-fit: cover;">
                <div class="card-body">
                    <h5 class="card-title">{{ validade.produto.dsdetalhe }}</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Código Principal:</strong> {{ validade.produto.cdprincipal }}</li>
                        <li class="list-group-item"><strong>Data de Validade:</strong> {{ validade.dtvalidade }}</li>
                        <li class="list-group-item"><strong>Quantidade em Estoque:</strong> {{ validade.qtestoque }}</li>
                    </ul>
                </div>
            </div>
        {% endfor %}
    
        <div class="card new-record-card mb-4" data-url="{% url 'expiration_form' %}" onclick="redirectToURL(this)">
            <div class="card-body text-center">
                <span style="font-size: 3em;">➕</span>
                <p class="card-text mt-2">Adicionar Novo Registro</p>
            </div>
        </div>
    </div>
    

    <div class="pagination mt-4">
        <span class="step-links">
            {% if validades_paginadas.has_previous %}
                <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="btn btn-outline-secondary">&laquo; primeira</a>
                <a href="?page={{ validades_paginadas.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="btn btn-outline-secondary">anterior</a>
            {% endif %}

            <span class="current btn btn-outline-secondary disabled">
                Página {{ validades_paginadas.number }} de {{ validades_paginadas.paginator.num_pages }}.
            </span>

            {% if validades_paginadas.has_next %}
                <a href="?page={{ validades_paginadas.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="btn btn-outline-secondary">próxima</a>
                <a href="?page={{ validades_paginadas.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="btn btn-outline-secondary">última &raquo;</a>
            {% endif %}
        </span>
    </div>

    <script>
        function redirectToURL(element) {
            var url = element.getAttribute('data-url');
            if (url) {
                window.location.href = url;
            }
        }
    </script>
{% endblock %}
